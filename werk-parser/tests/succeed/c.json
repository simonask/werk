[
    {
        "Config": {
            "ident": "out-dir",
            "value": "../../target/examples/c"
        }
    },
    {
        "Config": {
            "ident": "default",
            "value": "build"
        }
    },
    {
        "Let": {
            "ident": "cc",
            "value": {
                "type": "Which",
                "value": "clang"
            }
        }
    },
    {
        "Let": {
            "ident": "ld",
            "value": {
                "type": "Ident",
                "value": "cc"
            }
        }
    },
    {
        "Let": {
            "ident": "profile",
            "value": {
                "type": "StringExpr",
                "value": "debug"
            }
        }
    },
    {
        "Let": {
            "ident": "executable",
            "value": {
                "type": "StringExpr",
                "value": [
                    {
                        "stem": {
                            "type": "Ident",
                            "value": "profile"
                        }
                    },
                    "/example",
                    {
                        "stem": {
                            "type": "Ident",
                            "value": "EXE_SUFFIX"
                        }
                    }
                ]
            }
        }
    },
    {
        "Let": {
            "ident": "cflags",
            "value": {
                "type": "Chain",
                "value": {
                    "head": {
                        "type": "Ident",
                        "value": "profile"
                    },
                    "tail": [
                        {
                            "Match": {
                                "Braced": [
                                    {
                                        "pattern": [
                                            {
                                                "Literal": "debug"
                                            }
                                        ],
                                        "expr": {
                                            "type": "List",
                                            "value": {
                                                "items": [
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-g"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-O0"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fdiagnostics-color=always"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fcolor-diagnostics"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fansi-escape-codes"
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        "pattern": [
                                            {
                                                "Literal": "release"
                                            }
                                        ],
                                        "expr": {
                                            "type": "List",
                                            "value": {
                                                "items": [
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-O3"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fdiagnostics-color=always"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fcolor-diagnostics"
                                                    },
                                                    {
                                                        "type": "StringExpr",
                                                        "value": "-fansi-escape-codes"
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        "pattern": [
                                            "PatternStem"
                                        ],
                                        "expr": {
                                            "type": "Error",
                                            "value": [
                                                "Unknown profile '",
                                                {
                                                    "stem": {
                                                        "type": "Implied"
                                                    }
                                                },
                                                "'; valid options are 'debug' and 'release'"
                                            ]
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        }
    },
    {
        "Build": {
            "pattern": [
                {
                    "Interpolation": {
                        "stem": {
                            "type": "Ident",
                            "value": "profile"
                        }
                    }
                },
                {
                    "Literal": "/"
                },
                "PatternStem",
                {
                    "Literal": ".o"
                }
            ],
            "body": [
                {
                    "From": {
                        "type": "StringExpr",
                        "value": [
                            {
                                "stem": {
                                    "type": "PatternCapture"
                                }
                            },
                            ".c"
                        ]
                    }
                },
                {
                    "Depfile": {
                        "type": "StringExpr",
                        "value": [
                            "/",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "profile"
                                }
                            },
                            "/",
                            {
                                "stem": {
                                    "type": "PatternCapture"
                                }
                            },
                            ".c.d"
                        ]
                    }
                },
                {
                    "Run": {
                        "type": "Shell",
                        "value": [
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "cc"
                                }
                            },
                            " -c ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "cflags"
                                },
                                "options": {
                                    "ops": [],
                                    "join": " "
                                }
                            },
                            " -o ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "out"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            },
                            " ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "in"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            }
                        ]
                    }
                }
            ]
        }
    },
    {
        "Build": {
            "pattern": [
                {
                    "Interpolation": {
                        "stem": {
                            "type": "Ident",
                            "value": "profile"
                        }
                    }
                },
                {
                    "Literal": "/"
                },
                "PatternStem",
                {
                    "Literal": ".c.d"
                }
            ],
            "body": [
                {
                    "From": {
                        "type": "StringExpr",
                        "value": [
                            {
                                "stem": {
                                    "type": "PatternCapture"
                                }
                            },
                            ".c"
                        ]
                    }
                },
                {
                    "Run": {
                        "type": "Shell",
                        "value": [
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "cc"
                                }
                            },
                            " -MM -MT ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "in"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            },
                            " -MF ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "out"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            },
                            " ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "in"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            }
                        ]
                    }
                }
            ]
        }
    },
    {
        "Build": {
            "pattern": [
                {
                    "Interpolation": {
                        "stem": {
                            "type": "Ident",
                            "value": "executable"
                        }
                    }
                }
            ],
            "body": [
                {
                    "From": {
                        "type": "Chain",
                        "value": {
                            "head": {
                                "type": "Glob",
                                "value": "*.c"
                            },
                            "tail": [
                                {
                                    "Match": {
                                        "Braced": [
                                            {
                                                "pattern": [
                                                    "PatternStem",
                                                    {
                                                        "Literal": ".c"
                                                    }
                                                ],
                                                "expr": {
                                                    "type": "StringExpr",
                                                    "value": [
                                                        "/",
                                                        {
                                                            "stem": {
                                                                "type": "Ident",
                                                                "value": "profile"
                                                            }
                                                        },
                                                        {
                                                            "stem": {
                                                                "type": "PatternCapture"
                                                            }
                                                        },
                                                        ".o"
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                },
                {
                    "Run": {
                        "type": "Shell",
                        "value": [
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "ld"
                                }
                            },
                            " -o ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "out"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": null
                                }
                            },
                            " ",
                            {
                                "stem": {
                                    "type": "Ident",
                                    "value": "in"
                                },
                                "options": {
                                    "ops": [
                                        {
                                            "type": "ResolveOsPath"
                                        }
                                    ],
                                    "join": " "
                                }
                            }
                        ]
                    }
                }
            ]
        }
    },
    {
        "Task": {
            "name": "build",
            "body": [
                {
                    "Build": {
                        "type": "Ident",
                        "value": "executable"
                    }
                },
                {
                    "Info": [
                        "Build done for profile '",
                        {
                            "stem": {
                                "type": "Ident",
                                "value": "profile"
                            }
                        },
                        "'"
                    ]
                }
            ]
        }
    },
    {
        "Task": {
            "name": "run",
            "body": [
                {
                    "Build": {
                        "type": "StringExpr",
                        "value": "build"
                    }
                },
                {
                    "Run": {
                        "type": "Shell",
                        "value": {
                            "stem": {
                                "type": "Ident",
                                "value": "executable"
                            },
                            "options": {
                                "ops": [
                                    {
                                        "type": "ResolveOsPath"
                                    }
                                ],
                                "join": null
                            }
                        }
                    }
                }
            ]
        }
    },
    {
        "Task": {
            "name": "clean",
            "body": [
                {
                    "Let": {
                        "ident": "object-files",
                        "value": {
                            "type": "Chain",
                            "value": {
                                "head": {
                                    "type": "Glob",
                                    "value": "*.c"
                                },
                                "tail": [
                                    {
                                        "Map": [
                                            {
                                                "stem": {
                                                    "type": "Ident",
                                                    "value": "profile"
                                                }
                                            },
                                            {
                                                "stem": {
                                                    "type": "Implied"
                                                },
                                                "options": {
                                                    "ops": [
                                                        {
                                                            "type": "ReplaceExtension",
                                                            "from": ".c",
                                                            "to": ".o"
                                                        }
                                                    ],
                                                    "join": null
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        }
                    }
                },
                {
                    "Run": {
                        "type": "Block",
                        "value": [
                            {
                                "type": "Delete",
                                "value": {
                                    "type": "Ident",
                                    "value": "object-files"
                                }
                            },
                            {
                                "type": "Delete",
                                "value": {
                                    "type": "Ident",
                                    "value": "executable"
                                }
                            }
                        ]
                    }
                }
            ]
        }
    }
]
